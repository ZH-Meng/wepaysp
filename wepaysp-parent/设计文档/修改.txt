2016-12-18
	ALTER TABLE `partner_t`
MODIFY COLUMN `KEY_PATH`  varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL AFTER `PARTNER_KEY`;

2016-12-15
	新增 pay_notice_bind_weixin_t表
	store_t、dealer_employee_t 分别增加 bind_qr_code_path 字段

	CREATE TABLE PAY_NOTICE_BIND_WEIXIN_T
	(
	   IWOID                CHAR(32) NOT NULL COMMENT 'UUID',
	   STORE_OID            CHAR(32) COMMENT '支付门店',
	   PAY_DEALER_EMPLOYEE_OID CHAR(32) COMMENT '支付收银员',
	   BIND_DEALER_EMPLOYEE_OID CHAR(32) COMMENT '微信帐号绑定收银员',
	   OPENID               VARCHAR(32) NOT NULL COMMENT '唯一标识',
	   NICKNAME             VARCHAR(256) COMMENT '用户昵称',
	   SEX                  INT COMMENT '值为1时是男性，值为2时是女性，值为0时是未知',
	   TYPE                 CHAR(1) COMMENT '绑定类型，1绑定门店支付码，2绑定收银员支付码',
	   STATE                CHAR(1) NOT NULL COMMENT '1开启，2关闭',
	  `CREATOR` varchar(32) NOT NULL COMMENT '创建者',
	  `CREATE_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',
	  `MODIFIER` varchar(32) DEFAULT NULL COMMENT '最后修改者',
	  `MODIFY_TIME` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '记录最后修改时间',
	  `REMARK` varchar(256) DEFAULT NULL COMMENT '备注',
	   PRIMARY KEY (IWOID)
	);

	ALTER TABLE PAY_NOTICE_BIND_WEIXIN_T COMMENT '支付通知绑定微信账户表';

	ALTER TABLE PAY_NOTICE_BIND_WEIXIN_T ADD CONSTRAINT FK_PAY_NOTICE_BIND_WEIXIN_T_R101 FOREIGN KEY (STORE_OID)
		  REFERENCES STORE_T (IWOID) ON DELETE RESTRICT ON UPDATE RESTRICT;

	ALTER TABLE PAY_NOTICE_BIND_WEIXIN_T ADD CONSTRAINT FK_PAY_NOTICE_BIND_WEIXIN_T_R102 FOREIGN KEY (PAY_DEALER_EMPLOYEE_OID)
		  REFERENCES DEALER_EMPLOYEE_T (IWOID) ON DELETE RESTRICT ON UPDATE RESTRICT;

	ALTER TABLE PAY_NOTICE_BIND_WEIXIN_T ADD CONSTRAINT FK_PAY_NOTICE_BIND_WEIXIN_T_R103 FOREIGN KEY (BIND_DEALER_EMPLOYEE_OID)
		  REFERENCES DEALER_EMPLOYEE_T (IWOID) ON DELETE RESTRICT ON UPDATE RESTRICT;
	
	
	ALTER TABLE `store_t`
	ADD COLUMN `bind_qr_code_path`  varchar(256) NULL AFTER `qr_code_path`;
	
	ALTER TABLE `dealer_employee_t`
	ADD COLUMN `bind_qr_code_path`  varchar(256) NULL AFTER `qr_code_path`;
	
	
	
 weixin_pay_details_t 中的`trade_status`  使用说明：0：交易中  1：交易成功 2：交易失败  3:交易撤销（标准流程中自动触发的交易撤销）  4：交易关闭

`weixin_refund_details_t` 的交易撤销当做退款用。  这种交易撤销不用变更weixin_pay_details_t 的`trade_status`  ，但是需要更新它的退款金额字段。


ALTER TABLE `RPT_DEALER_STAT_DAY_T`
ADD COLUMN `REFUND_AMOUNT`  NUMERIC(16)  COMMENT '退款总笔数' AFTER `PARTNER_EMPLOYEE_NAME`;

ALTER TABLE `RPT_DEALER_STAT_DAY_T`
ADD COLUMN `REFUND_MONEY`  NUMERIC(20)  COMMENT '退款总金额 单位：分' AFTER `REFUND_AMOUNT`;

ALTER TABLE `RPT_DEALER_STAT_DAY_T`
ADD COLUMN `PAY_AMOUNT`  NUMERIC(16)  COMMENT '收款总笔数' AFTER `REFUND_MONEY`;

ALTER TABLE `RPT_DEALER_STAT_DAY_T`
ADD COLUMN `PAY_MONEY`  NUMERIC(20)  COMMENT '收款总金额 单位：分' AFTER `PAY_AMOUNT`;

 

ALTER TABLE `RPT_DEALER_STAT_MONTH_T`
ADD COLUMN `REFUND_AMOUNT`  NUMERIC(16)  COMMENT '退款总笔数' AFTER `PARTNER_EMPLOYEE_NAME`;

ALTER TABLE `RPT_DEALER_STAT_MONTH_T`
ADD COLUMN `REFUND_MONEY`  NUMERIC(20)  COMMENT '退款总金额 单位：分' AFTER `REFUND_AMOUNT`;

ALTER TABLE `RPT_DEALER_STAT_MONTH_T`
ADD COLUMN `PAY_AMOUNT`  NUMERIC(16)  COMMENT '收款总笔数' AFTER `REFUND_MONEY`;

ALTER TABLE `RPT_DEALER_STAT_MONTH_T`
ADD COLUMN `PAY_MONEY`  NUMERIC(20)  COMMENT '收款总金额 单位：分' AFTER `PAY_AMOUNT`;




ALTER TABLE `weixin_refund_details_t`
ADD COLUMN `END_TIME`  TIMESTAMP NULL DEFAULT NULL COMMENT '退款完成时间' AFTER `trans_end_time`,
ADD COLUMN `trade_status`  int(11)   COMMENT '退款状态 0：交易中  1：退款成功 2：退款失败 ' AFTER `END_TIME`,
ADD COLUMN `COUPON_REFUND_TYPE`  int(11) NULL COMMENT '1：撤销  2：退款' AFTER `TRANSACTION_ID`,
ADD COLUMN `WEIXIN_PAY_DETAILS_OID`  CHAR(32)  COMMENT '支付明细OID' AFTER `IWOID`,
MODIFY COLUMN `APPID`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT '微信公众号ID' AFTER `PARTNER_EMPLOYEE_OID`,
MODIFY COLUMN `NONCE_STR`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT '随机字符串' AFTER `DEVICE_INFO`,
MODIFY COLUMN `SIGN`  varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT '签名' AFTER `NONCE_STR`,
MODIFY COLUMN `TOTAL_FEE`  int(11) NULL COMMENT '订单总金额  单位为分  只能为整数' AFTER `COUPON_REFUND_TYPE`,
MODIFY COLUMN `REFUND_FEE`  int(11) NULL COMMENT '申请退款金额' AFTER `TOTAL_FEE`,
MODIFY COLUMN `RETURN_CODE`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT 'SUCCESS/FAIL此字段是通信标识' AFTER `REFUND_ACCOUNT`,
MODIFY COLUMN `RESULT_CODE`  varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT '业务结果' AFTER `RETURN_MSG`;




2016-12-04 23:00 add


ALTER TABLE `dealer_t`
ADD COLUMN `qr_code_path`	varchar(256) COMMENT '二维码存放路径' AFTER `sub_mch_id`;	 

ALTER TABLE `dealer_employee_t`
ADD COLUMN `qr_code_path`	varchar(256) COMMENT '二维码存放路径' AFTER `state`;	 

ALTER TABLE `store_t`
ADD COLUMN `qr_code_path`	varchar(256) COMMENT '二维码存放路径' AFTER `qr_code`;	 

通过上述更改实现  一商户一码、一门店一码、一收银员一码 三种模式的融合。

ALTER TABLE `dealer_employee_t`
ADD COLUMN `employee_type`	INT(11) COMMENT '员工类型  1：收银员  2：分店店长' AFTER `dealer_employee_id`;	 

通过上述更改实现门店店长的创建。（增加一个店长的角色，功能同收银员一致，增加“商户门店资金结算”“商户员工资金结算”）